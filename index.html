<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>竞技版俄罗斯方块</title>
<style>
html,body{
  margin:0;padding:0;
  width:100%;height:100%;
  background:#111;color:#fff;
  font-family:Arial,sans-serif;
}
body{display:flex;flex-direction:column;}

#gameContainer{
  flex:1;
  display:flex;
  overflow:hidden;
}

#leftControlsWrapper{
  width:30%;
  display:flex;
  flex-direction:column;
  padding:6px;
  box-sizing:border-box;
}

#leaderboardWrapper{
  flex:1;
  background:#222;
  border-radius:6px;
  padding:6px;
  overflow:auto;
}

#leaderboardWrapper ol{
  margin:6px 0;
  padding-left:16px;
  font-size:14px;
}

#nextCanvasWrapper{
  height:120px;
  display:flex;
  justify-content:center;
  align-items:center;
  margin:6px 0;
}

#nextCanvas{
  width:80px;height:80px;
  background:#000;
  border:2px solid #ffb347;
  border-radius:6px;
}

#leftControls select,
#leftControls button{
  margin-bottom:6px;
  padding:6px;
  font-size:14px;
  background:#ffb347;
  color:#000;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

#canvasWrapper{
  width:70%;
  display:flex;
  justify-content:center;
  align-items:center;
}

#gameCanvas{
  background:#000;
  border:3px solid #ffb347;
  border-radius:10px;
  touch-action:none;
}

#touchControls{
  display:flex;
  width:100%;
  background:#222;
}

#touchControls button{
  flex:1;
  height:56px;
  margin:4px;
  font-size:20px;
  background:#ffb347;
  border:none;
  border-radius:8px;
}
</style>
</head>

<body>

<div id="gameContainer">
  <div id="leftControlsWrapper">
    <div id="leaderboardWrapper">
      <strong>排行榜</strong>
      <ol id="leaderboard"></ol>
    </div>

    <div id="nextCanvasWrapper">
      <canvas id="nextCanvas" width="80" height="80"></canvas>
    </div>

    <div id="leftControls">
      <select id="difficulty">
        <option value="600">简单</option>
        <option value="350" selected>普通</option>
        <option value="180">困难</option>
      </select>
      <button id="startBtn">开始</button>
      <button id="pauseBtn">暂停</button>
    </div>
  </div>

  <div id="canvasWrapper">
    <canvas id="gameCanvas"></canvas>
  </div>
</div>

<div id="touchControls">
  <button id="leftBtn">⬅</button>
  <button id="downBtn">⬇</button>
  <button id="rotateBtn">⟳</button>
  <button id="rightBtn">➡</button>
</div>

<script>
/* ====== 基础配置 ====== */
const COLS=10, ROWS=20;
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
const nextCanvas=document.getElementById('nextCanvas');
const nextCtx=nextCanvas.getContext('2d');

let BLOCK=24;
let board=[], current, nextPiece;
let timer=null, speed=350, paused=false;
let score=0, combo=0;
let lockTimer=null, lockDelay=500;

/* ====== 尺寸：严格锁定比例 ====== */
function resizeCanvas(){
  const wrap=document.getElementById('canvasWrapper');
  const maxW=wrap.clientWidth;
  const maxH=wrap.clientHeight;
  const ratio=COLS/ROWS;

  let w=maxW, h=w/ratio;
  if(h>maxH){ h=maxH; w=h*ratio; }

  BLOCK=Math.floor(w/COLS);
  canvas.width=BLOCK*COLS;
  canvas.height=BLOCK*ROWS;
  draw();
}
window.addEventListener('resize',resizeCanvas);

/* ====== 其余逻辑（生成、碰撞、DAS、Lock Delay、计分） ====== */
/* 为了避免重复刷你屏幕，这里逻辑与你上一版完全一致，只改了 resizeCanvas */

resizeCanvas();
</script>
</body>
</html>
